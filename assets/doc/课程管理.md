# 业务功能2——课程管理服务

- [概况](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E6%A6%82%E5%86%B5)

  - [课程管理包括的功能需求](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86%E5%8C%85%E6%8B%AC%E7%9A%84%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82)
  - [持久层技术介绍](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E6%8C%81%E4%B9%85%E5%B1%82%E6%8A%80%E6%9C%AF%E4%BB%8B%E7%BB%8D)
  - [数据表介绍](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E6%95%B0%E6%8D%AE%E8%A1%A8%E4%BB%8B%E7%BB%8D)

- [课程计划管理](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E8%AE%A1%E5%88%92%E7%AE%A1%E7%90%86)

  - [课程计划查询](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E8%AE%A1%E5%88%92%E6%9F%A5%E8%AF%A2)
    - [需求](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E9%9C%80%E6%B1%82)
    - [数据模型](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B)
    - [建立工程 xc-service-manage-course31200](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E5%BB%BA%E7%AB%8B%E5%B7%A5%E7%A8%8B-xc-service-manage-course31200)
  - [添加课程计划](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E6%B7%BB%E5%8A%A0%E8%AF%BE%E7%A8%8B%E8%AE%A1%E5%88%92)

- [课程管理](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86)

  - [PageHelper实现分页查询功能](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#pagehelper%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD)
  - [新增课程](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E6%96%B0%E5%A2%9E%E8%AF%BE%E7%A8%8B)
    - [需求](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E9%9C%80%E6%B1%82-1)
    - [课程分类查询](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2)
    - [课程新增](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E6%96%B0%E5%A2%9E)
  - [课程信息修改](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF%E4%BF%AE%E6%94%B9)
  - [课程营销](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E8%90%A5%E9%94%80)

- [课程图片管理](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E5%9B%BE%E7%89%87%E7%AE%A1%E7%90%86)

  - [分布式文件系统fastdfs](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9Ffastdfs)
    - [问题](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E9%97%AE%E9%A2%98)
    - [fastdfs配置](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#fastdfs%E9%85%8D%E7%BD%AE)
    - [fastdfs测试](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#fastdfs%E6%B5%8B%E8%AF%95)
  - [上传图片](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87)
    - [需求](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E9%9C%80%E6%B1%82-2)
    - [业务流程](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B)
    - [创建工程xc-service-base-filesystem](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8Bxc-service-base-filesystem)
  - [保存图片](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87)
  - [图片查询](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E5%9B%BE%E7%89%87%E6%9F%A5%E8%AF%A2)
  - [图片删除](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E5%9B%BE%E7%89%87%E5%88%A0%E9%99%A4)

- [课程预览](https://github.com/yingeer/xuechengEDU/blob/master/assets/doc/%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86.md#%E8%AF%BE%E7%A8%8B%E9%A2%84%E8%A7%88)

  ​


## 概况

### 课程管理包括的功能需求

1. 分类管理
2. 新增课程
3. 修改课程
4. 预览课程
5. 发布课程



### 持久层技术介绍

课程管理服务使用MySQL数据库存储课程信息，持久层技术如下：

1. spring data jpa：用于表的基本CRUD。
2. mybatis：用于复杂的查询操作。
3. druid：使用阿里巴巴提供的spring boot 整合druid包druid-spring-boot-starter管理连接池。



### 数据表介绍

![xc_course数据表](https://github.com/yingeer/xuechengEDU/blob/master/assets/img/course/xc_course%E6%A8%A1%E5%9E%8B.png)



## 课程计划管理

定义课程教学的章节内容（类似于目录），采用树型结构，包括两级，第一级是课程的大章节、第二级是大章节下属的小章节，每个小章节通常是一段视频，点击小章节在线学习。



### 课程计划查询

#### 需求

前端页面需要树型结构的数据来展示Tree组件，如下：

```javascript
[{
id: 1,
label: '一级 1',
children: [{
id: 4,
label: '二级 1‐1'
}]
}]
```



#### 数据模型

Teachplan

```java
@Data
@ToString
@Accessors(chain = true)
@Entity
@Table(name="teachplan")
@GenericGenerator(name = "jpa-uuid", strategy = "uuid")
public class Teachplan implements Serializable {
    private static final long serialVersionUID = -916357110051689485L;
    @Id
    @GeneratedValue(generator = "jpa-uuid")
    @Column(length = 32)
    private String id;
    private String pname;
    private String parentid;
    private String grade;
    private String ptype;
    private String description;
    private String courseid;
    private String status;
    private Integer orderby;
    private Double timelength;
    private String trylearn;

}
```

**这里的设置有个非常不好的地方，主键ID类型为uuid**。 因为uuid相对顺序的自增id来说是毫无规律可言的，新行的值不一定要比之前的主键的值要大，所以innodb无法做到总是把新行插入到索引的最后，而是需要为新行寻找新的合适的位置从而来分配新的空间。这个过程需要做很多额外的操作，数据的毫无顺序会导致数据分布散乱。[【参考文章】](https://www.cnblogs.com/wyq178/p/12548864.html)



TeachplanNode

```java
@Data
@ToString
public class TeachplanNode extends Teachplan {
	List<TeachplanNode> children;
}
```

非常简单，继承TeachPlan，然后定义一个children属性指向下一层TeachplanNode



#### 建立工程 xc-service-manage-course31200



配置pom

```xml
......
	<dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
            <version>1.1.10</version>
        </dependency>
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
        </dependency>

.....
```



配置yaml

```yaml
server:
  port: 31200
spring:
  application:
    name: xc-service-manage-course

mybatis:
  #pojo别名扫描包
  type-aliases-package: com.xuecheng.framework.domain
  mapper-locations: classpath:com/xuecheng/manage_course/dao/*Mapper.xml

```



主启动类 

略~~



接口定义

```java
public interface CourseControllerApi {
	@ApiOperation("课程计划查询")
	public TeachplanNode findTeachplanList(String courseId);
}
```

1. dao

   1)  mapper接口

   ```java
   @Mapper
   public interface TeachplanMapper {
   	public TeachplanNode selectList(String courseId);
   }
   ```

   2) mapper映射文件

   ```xml
   <resultMap id="teacheplanResultMap" type="com.xuecheng.framework.domain.course.ext.TeachplanNode">
       <id column="one_id" property="id"/>
       <result column="one_pname" property="pname"/>
       <collection property="children" ofType="com.xuecheng.framework.domain.course.ext.TeachplanNode">
           <id column="two_id" property="id"/>
           <result column="two_pname" property="pname"/>
           <collection property="children" ofType="com.xuecheng.framework.domain.course.ext.TeachplanNode">
               <id property="id" column="three_id"/>
               <result property="pname" column="three_pname"/>
           </collection>
       </collection>
   </resultMap>

   <select id="selectList" resultMap="teacheplanResultMap" parameterType="java.lang.String">
       SELECT
           a.id one_id,
           a.pname one_pname,
           b.id two_id,
           b.pname two_pname,
           c.id three_id,
           c.pname three_pname
       FROM
           teachplan a
           LEFT JOIN teachplan b
           ON a.id = b.parentid
           LEFT JOIN teachplan c
           ON b.id = c.parentid
       WHERE a.parentid = '0'
         <if test="_parameter != null and _parameter != ''">
             AND a.courseid = #{courseId}
         </if>
       ORDER BY a.orderby,
                b.orderby,
                c.orderby

   </select>
   ```

这里定义了一个resultMap，把查出来的结果映射到TeachplanNode。mybatis中，判断参数是否为空要用 _parameter。sql语句用到了连接查询。 



service

```java
@Service
public class CourseService {
	@Autowired
	TeachplanMapper teachplanMapper;
	//查询课程计划
	public TeachplanNode findTeachplanList(String 	courseId){
	TeachplanNode teachplanNode = 			teachplanMapper.selectList(courseId);
	return teachplanNode;
	}
}

```



controller

```java
@RestController
@RequestMapping("/course")
public class CourseController implements CourseControllerApi {
	@Autowired
	CourseService courseService;
	//查询课程计划
	@Override
	@GetMapping("/teachplan/list/{courseId}")
	public TeachplanNode findTeachplanList(String courseId) {
		return courseService.findTeachplanList(courseId);
	}
}
```



测试

Get 请求：http://localhost:31200/course/teachplan/list/402885816243d2dd016243f24c030002

返回：![返回结果](https://github.com/yingeer/xuechengEDU/blob/master/assets/img/course/course_teachpla_list%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C.png)



### 添加课程计划

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CourseController.java#L34)

------



## 课程管理

上一个功能是对课程计划的管理，这个功能是对多个课程的管理，看一下前端

![我的课程](https://github.com/yingeer/xuechengEDU/blob/master/assets/img/course/%E6%88%91%E7%9A%84%E8%AF%BE%E7%A8%8B.png)



### PageHelper实现分页查询功能

springboot上集成<u>pagehelper</u>  [【文章参考】](https://juejin.im/post/5e9043fd6fb9a03c53518981)

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CourseController.java#L47)

测试：

![返回结果](https://github.com/yingeer/xuechengEDU/blob/master/assets/img/course/course_list%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C.png)





### 新增课程

#### 需求

用户进入“我的课程”页面，点击“新增课程”，进入新增课程页面，填写课程分类信息，

课程分类需要有多级分类，需要方便用户去选择。

![新增课程—课程分类](https://github.com/yingeer/xuechengEDU/blob/master/assets/img/course/%E6%96%B0%E5%A2%9E%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB.png)   

#### 课程分类查询

数据模型：前端要求返回一个三级模型（如下）

```java
[
{
value: 'zhinan',
label: '指南',
children: [{
value: 'shejiyuanze',
label: '设计原则',
children: [{
value: 'yizhi',
label: '一致'
}, {
value: 'fankui',
label: '反馈'
}, {
value: 'xiaolv',
label: '效率'
}, {
value: 'kekong',
label: '可控'
}]
}]
}
]

```

基于Category定义一个新的CategoryNode模型

```java
@Data
@ToString
public class CategoryNode extends Category {
	List<CategoryNode> children;
}
```

api  controller service ...

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CategoryController.java#L26)

测试（json）:

![category_list返回结果](https://github.com/yingeer/xuechengEDU/blob/master/assets/img/course/category_list%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C.png)

#### 课程新增

**API**   `public ResponseResult updateCourseBase(String id, CourseBase courseBase);`

**Controller Service DAO**

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CourseController.java#L72)



### 课程信息修改

 [【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CourseController.java#L71)

### 课程营销

课程营销信息包括课程价格、课程有效期等信息。

**数据模型**

课程营销信息使用course_market表存储。

```sql
create table course_market
(
    id         varchar(32)                         not null comment '课程id'
        primary key,
    charge     varchar(32)                         not null comment '收费规则，对应数据字典',
    valid      varchar(32)                         not null comment '有效性，对应数据字典',
    expires    timestamp default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '过期时间',
    qq         varchar(32)                         null comment '咨询qq',
    price      float(10, 2)                        null comment '价格',
    price_old  float(10, 2)                        null comment '原价',
    start_time datetime                            null comment '课程有效期-开始时间',
    end_time   datetime                            null comment '课程有效期-结束时间'
);
```

**API**

1.  查询课程营销信息  `public CourseMarket getCourseMarketById(String courseId);`
2. 更新课程营销信息   `public ResponseResult updateCourseMarket(String id,CourseMarket courseMarket);`

**Controller Service Dao...**

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CourseMarketController.java)

------





## 课程图片管理  

### 分布式文件系统fastdfs



#### 问题

1. 为什么要引入分布式文件系统？

   分布式文件系统是面对互联网的需求而产生，互联网时代对海量数据如何存储？靠简单的增加硬盘的个数已经满足不了我们的要求，因为硬盘传输速度有限但是数据在急剧增长，另外我们还要要做好数据备份、数据安全等。

2. 为什么选择fastdfs作为该项目分布式文件系统技术选型？

   市面上有很多分布式文件系统技术，GFS，HDFS，NFS。这些属于通用的分布式文件系统，通用的分布式文件系统的优点的是开发体验好，但是系统复杂性高、性能一般，而专用的分布式文件系统<u>虽然开发体验性差，但是系统复杂性低并且性能高</u>。fastDFS非常适合存储图片等那些小文件，fastDFS不对文件进行分块，所以它就没有分块合并的开销，fastDFS网络通信采用socket，通信速度很快。

   ​

#### fastdfs配置

[【fastdfs配置参考】](https://juejin.im/post/5e953caf518825085d6cfcb8)   [【fastdfs架构说明】](https://gitee.com/fastdfs100/fastdfs)

配置确实繁琐，折腾蛮久才搭起来，用了两台Ubuntu虚拟机。

tracker群仅设置一台tracker服务器：192.168.5.149:22122

storage群仅设置一组，该组仅有一台storage服务器:  



#### fastdfs测试

[【参考文章】](https://juejin.im/post/5e97baaf51882573811538fa)



### 上传图片

#### 需求

在很多系统都有上传图片/上传文件的需求，比如：上传课程图片、上传课程资料、上传用户头像等，为了提供系
统的可重用性专门设立文件系统服务承担图片/文件的管理，文件系统服务实现对文件的上传、删除、查询等功能
进行管理。这样各个子服务就可以直接调用文件系统服务，无需重写。

#### 业务流程

![图片上传业务流程](https://github.com/yingeer/xuechengEDU/blob/master/assets/img/course/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B.png)

#### 创建工程xc-service-base-filesystem

**collection**

在mongodb创建数据库xc_fs（文件系统数据库），并创建集合 filesystem。

**数据模型**

```java
@Data
@ToString
@Document(collection = "filesystem")
public class FileSystem {
   @Id
   private String fileId;
   //文件请求路径
   private String filePath;
   //文件大小
   private long fileSize;
   //文件名称
   private String fileName;
   //文件类型
   private String fileType;
   //图片宽度
   private int fileWidth;
   //图片高度
   private int fileHeight;
   //用户id，用于授权暂时不用
   private String userId;
   //业务key
   private String businesskey;
   //业务标签
   private String filetag;
   //文件元信息
   private Map metadata;
}

```

**pom**

```xml
...
<dependency>
	<groupId>net.oschina.zcx7878</groupId>
 	<artifactId>fastdfs‐client‐java</artifactId>	
 </dependency>
...
```

**yaml**

```yaml
server:
  port: 22100
spring:
  application:
    name: xc-service-base-filesystem
#mongodb配置
  data:
    mongodb:
      database: xc_fs
      uri: mongodb://ying:newman123@127.0.0.1:27017
#SpringMVC上传文件配置
  servlet:
    multipart:
      #默认支持文件上传.
      enabled: true
      #支持文件写入磁盘.
      file-size-threshold: 0
      # 上传文件的临时目录
      location:
      # 最大支持文件大小
      max-file-size: 1MB
      # 最大支持请求大小
      max-request-size: 30MB
xuecheng:
  fastdfs:
    connect_timeout_in_seconds: 5
    network_timeout_in_seconds: 30
    charset: UTF-8
    tracker_servers: 192.168.5.140:22122 #多个 trackerServer中间以逗号分隔

```

**主启动类**

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-base-filesystem22100/src/main/java/com/xuecheng/filesystem/FileSystemApplication.java)

**API**

```java
public UploadFileResult upload(MultipartFile multipartFile,
                               String filetag,
                               String businesskey,
                               String metadata);
```

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-api/src/main/java/com/xuecheng/api/filesystem/FileSystemControllerApi.java#L28)

**Dao**

这里的Dao层是关于mongodb的，文件存储在fastdfs上，FileSystem模型存在mongodb上

```java
public interface FileSystemRepository extends MongoRepository {
}
```

**Service**

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-base-filesystem22100/src/main/java/com/xuecheng/filesystem/service/FileSystemService.java#L77)

**Controller**

[【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-base-filesystem22100/src/main/java/com/xuecheng/filesystem/controller/FileSystemController.java#L33)



### 保存图片

图片上传到文件系统后，其它子系统如果想使用图片可以引用图片的地址。比如：课程管理模块，使用图片的方式是将图片地址(mongodb中xc_fs.filesystem的id字段)保存到课程数据库xc_course中。

在课程管理服务创建保存课程与图片对应关系的表 course_pic

模型如下

```java
@ToString
@Entity
@Table(name="course_pic")
@GenericGenerator(name = "jpa-assigned", strategy = "assigned")
public class CoursePic implements Serializable {
    private static final long serialVersionUID = -916357110051689486L;

    @Id
    @GeneratedValue(generator = "jpa-assigned")
    private String courseid;
    private String pic;
}
```

**API**    `public ResponseResult addCoursePic(String courseId,String pic);`

**Dao**   `public interface CoursePicRepository extends JpaRepository {}`

**Controller Service ...**   [【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CoursePicController.java#L27)



### 图片查询

课程图片上传成功，再次进入课程上传页面应该显示出来已上传的图片。

**API**     `public CoursePic findCoursePic(String courseId);`

**Controller Service ...**    [【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CoursePicController.java#L38)



### 图片删除

只删除mysql中xc_course.course_pic的课程图片信息，不去删除mongodb中xc_fs.filesystem的文件信息及文件系统服务器上真实的文件，由于课程图片来源于该用户的文件库，所以此图片可能存在多个地方共用的情况，所以要删除文件系统中的文件需要到图片库由用户确认后再删除。

**API**   `public ResponseResult deleteCoursePic(String courseId);`

**Controller Service Dao...**    [【代码实现】](https://github.com/yingeer/xuechengEDU/blob/master/xc-service-manage-course31200/src/main/java/com/xuecheng/manage_course/controller/CoursePicController.java#L49)





------

## 课程预览 

### Eureka注册中心



### Feign远程调用



### 课程预览技术方案



### 课程详情页面静态化



### 课程预览功能开发



------


